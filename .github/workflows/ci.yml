name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  submodule_gate:
    uses: Architit/RADRILONIUMA-PROJECT/.github/workflows/submodule-gate.yml@submodule-gate-v1.0.0
    with:
      python_version: "3.12"
      submodule_paths: |
        agents/test-agent
        agents/operator-agent
      install_command: |
        true
      test_command: |
        true
    secrets: inherit

  build:
    needs: submodule_gate
    runs-on: ubuntu-latest

    env:
      GH_SUBMODULE_TOKEN: ${{ secrets.SUBMODULE_PAT }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: recursive
          token: ${{ env.GH_SUBMODULE_TOKEN != '' && env.GH_SUBMODULE_TOKEN || github.token }}

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Upgrade pip
        run: python -m pip install --upgrade pip

      - name: Install requirements-dev
        run: python -m pip install -r requirements-dev.txt

      - name: Pylint
        run: pylint src
        continue-on-error: true

      - name: Ruff
        run: ruff check .
        continue-on-error: true

      - name: Mypy
        run: mypy src

      - name: Pytest
        run: pytest -q tests/test_ping_pong.py
